  
<?php

/**
 * @file
 * An Islandora viewer module using Kaltura and Panopto
/**
 * Implements hook_islandora_viewer_info().
 */
function islandora_video_streaming_islandora_viewer_info() {
  return array(
    'islandora_video_streaming_kaltura' => array(
      'label' => t('Kaltura'),
      'description' => t('Use Kaltura and override the viewer'),
      'callback' => 'islandora_video_streaming_kaltura_callback',
      'mimetype' => array('application/javascript'),
      'configuration' => '',
    ),
      'islandora_video_streaming_panopto' => array(
      'label' => t('Panopto'),
      'description' => t('Use Panopto and override the viewer'),
      'callback' => 'islandora_video_streaming_panopto_callback',
      'mimetype' => array('application/javascript'),
      'configuration' => '',
    ),
  );
}

/**
 * Implements hook_menu().
 * Question: When do I need this?
 */
function islandora_video_streaming_menu() {
  return array(
    'admin/islandora/islandora_viewers/video_streaming' => array(
      'title' => 'Video.js',
      'description' => 'Configure the Video.js viewer.',
      'page callback' => 'drupal_get_form',
      'access arguments' => array('administer site configuration'),
      'page arguments' => array('islandora_video_streaming_admin'),
      'file' => 'includes/admin.form.inc',
      'type' => MENU_NORMAL_ITEM,
    ),
  );
}

/**
 * Implements hook_theme().
 * TODO: key islandora_video_streaming might need to change
 */
function islandora_video_streaming_theme($existing, $type, $theme, $path) {
  drupal_set_message("HOOK THEME");
    return array(
    'islandora_video_streaming' => array(
      'template' => 'theme/islandora-video-streaming',
      'variables' => array('object' => NULL, 'params' => NULL),
    ),
  );
}

/**
 * Implements template_preprocess_HOOK().
 */
function template_preprocess_islandora_video_streaming(array &$variables) {
  $params = $variables['params'];
  $variables['sources'] = array();
  if (isset($params['tn'])) {
    $variables['tn'] = $params['tn'];
  }
}

/**
 * Callback function to process audio player.
 *
 * @param array $params
 *   Array with configuration info for the audio player.
 */
function islandora_video_streaming_kaltura_callback($params = array()) {
  return theme('islandora_video_streaming', array('params' => $params));
}